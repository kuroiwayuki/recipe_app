<%= form_with model: recipet, local: true do |f| %>
  <div class="space-y-6 bg-white p-6 rounded-lg shadow-md max-w-3xl mx-auto" data-controller="recipet-items">
    
    <div>
      <%= f.label :purchased_at, "購入日", class: "block text-sm font-semibold text-gray-700 mb-1" %>
      <%= f.date_select :purchased_at, {}, class: "border border-gray-300 rounded px-3 py-2" %>
    </div>

    <div id="recipet_items" data-recipet-items-target="container" class="space-y-6">
      <% recipet.recipet_items.each_with_index do |ri, i| %>
        <%= render "recipet_item_fields", f: f, ri: ri, index: i %>
      <% end %>
    </div>
    <%# 追加ボタンのクリックでstimulusのaddアクションが走る%>
    <div>
      <button type="button" data-action="recipet-items#add" class="bg-green-600 text-white px-4 py-2 rounded">
        ＋ 次の商品を追加
      </button>
    </div>

    <div>
      <%= f.submit "保存", class: "bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition" %>
    </div>

    <template data-recipet-items-target="template">
      <%= f.fields_for :recipet_items, RecipetItem.new(item: Item.new(category: Category.new)), child_index: "NEW_RECORD" do |ri_fields| %>
        <%= render "recipet_item_fields", f: ri_fields %>
      <% end %>
    </template>
  </div>
<% end %>
